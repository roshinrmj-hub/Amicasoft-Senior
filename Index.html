<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amica Soft - Senior High Math</title>
    <style>
        /* --- THEME & VARIABLES --- */
        :root {
            --primary: #FF6B6B;      /* Soft Red */
            --secondary: #4ECDC4;    /* Teal */
            --accent: #FFE66D;       /* Yellow */
            --dark: #292f36;         /* Dark Grey */
            --light: #f7f9fc;        /* Light Grey/Blue */
            --white: #ffffff;
            --orange: #FF9F1C;
            --font-formal: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0; padding: 0;
            font-family: var(--font-formal);
            background-color: var(--light);
            color: #333;
            padding-top: 80px;
        }

        /* --- HEADER --- */
        .site-header {
            position: fixed; top: 0; left: 0; right: 0; height: 70px;
            background: var(--white); box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 5%; z-index: 1000;
        }
        .brand-logo { font-size: 1.6rem; font-weight: 800; color: var(--dark); text-decoration: none; }
        .brand-logo span { color: var(--secondary); }
        .user-profile { display: flex; align-items: center; gap: 10px; background: #f0f4f8; padding: 5px 15px; border-radius: 30px; }

        /* --- CONTAINER --- */
        .main-container { max-width: 900px; margin: 0 auto; padding: 20px; text-align: center; }
        
        /* CLASS NAV */
        .class-nav { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .class-btn {
            background: #eee; border: none; padding: 10px 20px; border-radius: 25px;
            cursor: pointer; font-size: 1rem; font-weight: bold; color: #555;
            transition: all 0.2s;
        }
        .class-btn:hover { background: #ddd; transform: translateY(-2px); }
        .class-btn.active { background: var(--dark); color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

        /* TOPIC NAV */
        .topic-nav { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; margin-bottom: 30px; }
        .topic-btn {
            background: white; border: 2px solid var(--secondary); color: var(--secondary);
            padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; margin-bottom: 5px;
        }
        .topic-btn.active { background: var(--secondary); color: white; }

        /* --- HEADLINE AREA --- */
        .headline-area { margin-bottom: 20px; animation: fadeIn 0.5s ease-out;}
        .problem-title { font-size: 2rem; color: var(--dark); margin: 0 0 10px 0; }
        .problem-desc { 
            font-size: 1.1rem; color: #555; font-style: italic; 
            background: #eef2f5; display: inline-block; padding: 8px 20px; 
            border-radius: 20px; border: 1px solid #dee2e6;
        }

        /* --- WORKSPACE --- */
        .workspace {
            background: white; border-radius: 20px; padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.05);
            border-top: 6px solid var(--primary);
            min-height: 400px; position: relative;
            animation: slideUp 0.4s ease-out;
        }
        
        /* Real World Context Box */
        .real-world-box {
            background: #e3f2fd; color: #0d47a1; padding: 15px; border-radius: 8px;
            margin: 0 auto 25px auto; max-width: 90%; font-size: 1rem; border: 1px dashed #2196f3;
            display: none; text-align: left;
        }

        .math-display {
            font-size: 2rem; font-family: 'Times New Roman', serif;
            margin: 20px 0; color: #333; font-weight: bold; line-height: 1.4;
            display: flex; align-items: center; justify-content: center; gap: 15px; flex-wrap: wrap;
        }

        /* Fraction Style for Exponents */
        .frac {
            display: inline-flex; flex-direction: column; align-items: center; vertical-align: middle; margin: 0 5px;
        }
        .frac-top { border-bottom: 3px solid #333; padding-bottom: 2px; width: 100%; text-align: center; }
        .frac-bot { padding-top: 2px; width: 100%; text-align: center; }

        .input-area { margin: 30px 0; display: flex; justify-content: center; gap: 10px; align-items: center;}
        .math-input {
            padding: 12px; width: 160px; text-align: center; font-size: 1.3rem;
            border: 2px solid #ddd; border-radius: 10px; outline: none;
        }
        .math-input:focus { border-color: var(--primary); }

        .action-btn {
            padding: 12px 25px; border: none; border-radius: 10px;
            font-size: 1rem; font-weight: bold; cursor: pointer; color: white;
            transition: transform 0.1s;
        }
        .btn-check { background: var(--secondary); box-shadow: 0 4px 0 #3aa8a0; }
        .btn-check:active { transform: translateY(4px); box-shadow: none; }
        
        .btn-new { background: var(--orange); box-shadow: 0 4px 0 #e08e1a; margin-left: 10px;}
        .btn-new:active { transform: translateY(4px); box-shadow: none; }

        .btn-steps {
            display: block; margin: 30px auto 0 auto;
            background: transparent; color: #777; border: 2px solid #ccc;
            padding: 10px 25px; border-radius: 25px; cursor: pointer; font-weight: 600;
        }
        .btn-steps:hover { border-color: var(--dark); color: var(--dark); background: #f9f9f9;}

        /* --- FEEDBACK & STEPS --- */
        .feedback { font-size: 1.4rem; font-weight: bold; margin-top: 20px; height: 30px; }
        .correct { color: #27ae60; } .wrong { color: var(--primary); }

        .step-container {
            margin-top: 30px; text-align: left; background: #f8f9fa;
            padding: 25px; border-radius: 15px; border-left: 5px solid var(--secondary);
            display: none; animation: slideDown 0.3s ease-out;
        }
        .step-title { font-weight: bold; color: var(--dark); margin-bottom: 15px; font-size: 1.2rem; border-bottom: 1px solid #ddd; padding-bottom: 5px;}
        .step-line { margin-bottom: 10px; font-family: 'Segoe UI', sans-serif; font-size: 1.05rem; color: #444; line-height: 1.6; }
        .step-line b { color: var(--dark); }
        
        /* FORMULA BOX */
        .formula-box {
            background: #2c3e50; color: #fff; padding: 15px; border-radius: 8px;
            margin-bottom: 20px; font-family: 'Courier New', monospace; font-size: 1.15rem;
            text-align: center; border: 2px solid var(--accent);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .var-highlight { color: var(--primary); font-weight: bold; }
        .group-box { border: 2px dashed #999; padding: 2px 5px; margin: 0 2px; border-radius: 4px; background: #e0e0e0; display: inline-block; }

        /* VISUAL */
        .diagram-stage { height: 200px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideDown { from { opacity: 0; height: 0; } to { opacity: 1; height: auto; } }

    </style>
</head>
<body>

    <nav class="site-header">
        <a href="#" class="brand-logo">Amica<span>Soft</span> Senior</a>
        <div class="user-profile">
            <span>üéì High School Edition</span>
        </div>
    </nav>

    <div class="main-container">
        <div class="class-nav">
            <button class="class-btn active" onclick="app.loadClass(8)">Class 8</button>
            <button class="class-btn" onclick="app.loadClass(9)">Class 9</button>
            <button class="class-btn" onclick="app.loadClass(10)">Class 10</button>
        </div>

        <div class="topic-nav" id="topic-container"></div>

        <div class="headline-area">
            <h2 class="problem-title" id="p-title">Select a Topic</h2>
            <div class="problem-desc" id="p-desc">Choose a class and topic to begin practicing.</div>
        </div>

        <div class="workspace">
            <div id="diagram-area" class="diagram-stage"></div>
            
            <div id="real-world-ctx" class="real-world-box"></div>
            
            <div class="math-display" id="p-equation"></div>

            <div class="input-area">
                <input type="number" id="user-input" class="math-input" placeholder="Answer = ?" step="0.01">
                <button class="action-btn btn-check" onclick="app.checkAnswer()">Check</button>
                <button class="action-btn btn-new" onclick="app.newProblem()">New Question</button>
            </div>

            <div id="feedback-display" class="feedback"></div>

            <button class="btn-steps" onclick="app.toggleSteps()">üí° Show Formula & Steps</button>
            
            <div id="step-box" class="step-container">
                <div id="formula-display" class="formula-box"></div>
                <div class="step-title">Solution Breakdown:</div>
                <div id="step-content"></div>
            </div>
        </div>
    </div>

    <script>
        /* AMICA SOFT LOGIC ENGINE */
        const app = {
            currentClass: 8,
            currentTopic: null,
            currentData: {},
            
            // --- CURRICULUM CONFIGURATION ---
            curriculum: {
                8: [
                    { id: 'c8_vol', name: '3D Volumes', handler: 'generateVolume' },
                    { id: 'c8_roots', name: 'Squares/Cubes', handler: 'generateRootsManual' },
                    { id: 'c8_exp', name: 'Exponents', handler: 'generateExponentsFrac' },
                    { id: 'c8_lin', name: 'Linear Eq', handler: 'generateLinear' },
                    { id: 'c8_quad_form', name: 'Quad Formula (Intro)', handler: 'generateQuadFormula8' }
                ],
                9: [
                    { id: 'c9_angles', name: 'Angles & Parallel Lines', handler: 'generateAnglesBisect' },
                    { id: 'c9_circles', name: 'Circle Areas', handler: 'generateCircles' },
                    { id: 'c9_heron', name: 'Heron\'s Formula', handler: 'generateHeron' },
                    { id: 'c9_stats', name: 'Statistics', handler: 'generateStats' }
                ],
                10: [
                    { id: 'c10_ap_term', name: 'AP Term (Find n)', handler: 'generateAPTerm' },
                    { id: 'c10_ap_sum', name: 'AP Sum (Total)', handler: 'generateAPSum' },
                    { id: 'c10_gp_term', name: 'GP Term', handler: 'generateGPTerm' },
                    { id: 'c10_gp_sum', name: 'GP Sum (Multiplier)', handler: 'generateGPSum' },
                    { id: 'c10_trig', name: 'Trigonometry (Basic)', handler: 'generateTrig' },
                    { id: 'c10_trig_adv', name: 'Trigonometry (Adv)', handler: 'generateTrigAdvanced' },
                    { id: 'c10_quad', name: 'Quadratic Eq', handler: 'generateQuadFormula10' }
                ]
            },

            loadClass: function(cls) {
                this.currentClass = cls;
                document.querySelectorAll('.class-btn').forEach(b => b.classList.remove('active'));
                event.target.classList.add('active');
                const topicContainer = document.getElementById('topic-container');
                topicContainer.innerHTML = '';
                const topics = this.curriculum[cls] || [];
                topics.forEach((t, index) => {
                    const btn = document.createElement('button');
                    btn.className = `topic-btn ${index === 0 ? 'active' : ''}`;
                    btn.innerText = t.name;
                    btn.onclick = (e) => this.switchTopic(e, t);
                    topicContainer.appendChild(btn);
                });
                if(topics.length > 0) this.switchTopic(null, topics[0]);
            },

            switchTopic: function(e, topicObj) {
                if(e) {
                    document.querySelectorAll('.topic-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                }
                this.currentTopic = topicObj;
                this.newProblem();
            },

            newProblem: function() {
                // Reset UI
                document.getElementById('user-input').value = '';
                document.getElementById('feedback-display').innerText = '';
                document.getElementById('step-box').style.display = 'none';
                document.getElementById('diagram-area').innerHTML = '';
                document.getElementById('real-world-ctx').style.display = 'none'; 

                if (this.currentTopic && generators[this.currentTopic.handler]) {
                    this.currentData = generators[this.currentTopic.handler]();
                    
                    document.getElementById('p-title').innerText = this.currentTopic.name;
                    document.getElementById('p-desc').innerHTML = this.currentData.desc;
                    document.getElementById('p-equation').innerHTML = this.currentData.display;
                    
                    if(this.currentData.svg) document.getElementById('diagram-area').innerHTML = this.currentData.svg;
                    
                    if(this.currentData.realWorld) {
                        const box = document.getElementById('real-world-ctx');
                        box.style.display = 'block';
                        box.innerHTML = this.currentData.realWorld;
                    }
                }
            },

            checkAnswer: function() {
                const userVal = parseFloat(document.getElementById('user-input').value);
                const correctVal = parseFloat(this.currentData.answer);
                const feedback = document.getElementById('feedback-display');
                
                // Allow small margin for error
                if(Math.abs(userVal - correctVal) < 0.25) {
                    feedback.innerText = "Correct! Great Job! üéâ";
                    feedback.className = "feedback correct";
                } else {
                    feedback.innerText = "Not quite. Check the steps below! ‚ùå";
                    feedback.className = "feedback wrong";
                }
            },

            toggleSteps: function() {
                const box = document.getElementById('step-box');
                const content = document.getElementById('step-content');
                const formula = document.getElementById('formula-display');
                
                if(box.style.display === 'block') {
                    box.style.display = 'none';
                } else {
                    formula.style.display = this.currentData.formula ? 'block' : 'none';
                    if(this.currentData.formula) formula.innerHTML = this.currentData.formula;
                    
                    content.innerHTML = this.currentData.steps.map(s => `<div class="step-line">${s}</div>`).join('');
                    box.style.display = 'block';
                }
            }
        };

        /* --- CONTENT GENERATORS --- */
        const generators = {
            
            // Utility for generating random integers
            randInt: (min, max) => Math.floor(Math.random() * (max - min + 1)) + min,
            
            // ================= CLASS 8 =================
            generateRootsManual: function() {
                const type = Math.random() > 0.5 ? 'square' : 'cube';
                let base, val, sym, factors = [], groupedStr;
                
                if(type === 'square') {
                    const primes = [2, 3, 5];
                    const p1 = primes[this.randInt(0, 1)]; // 2 or 3
                    const p2 = primes[this.randInt(0, 2)]; // 2, 3, or 5
                    base = p1 * p2;
                    val = base * base;
                    sym = '‚àö';
                    factors = [p1, p1, p2, p2].sort((a,b)=>a-b);
                    groupedStr = `<span class="group-box">${factors[0]}√ó${factors[1]}</span> √ó <span class="group-box">${factors[2]}√ó${factors[3]}</span>`;
                } else {
                    base = this.randInt(2, 5); 
                    val = base*base*base;
                    sym = '‚àõ';
                    groupedStr = `<span class="group-box">${base}√ó${base}√ó${base}</span>`;
                }

                return {
                    answer: base,
                    desc: `Find the ${type} root using factorization.`,
                    display: `${sym}${val} = ?`,
                    formula: type==='square' ? "Pair Factors: (a√óa) ‚Üí a" : "Group Triplets: (a√óa√óa) ‚Üí a",
                    steps: [
                        `1. Find factors of ${val}.`,
                        `2. Group them: ${groupedStr}`,
                        `3. Pick one from each group.`,
                        type === 'square' ? `4. Result: ${factors[0]} √ó ${factors[2]} = <b>${base}</b>` : `4. Result: <b>${base}</b>`
                    ]
                };
            },

            generateExponentsFrac: function() {
                const base = this.randInt(2, 5);
                const mode = Math.random() > 0.5 ? 'mult' : 'div';
                
                if (mode === 'mult') {
                    const m = this.randInt(2, 6);
                    const n = this.randInt(2, 6);
                    const ans = m + n;
                    return {
                        answer: ans,
                        desc: "Solve for x using the Product Rule (Multiplication).",
                        display: `${base}<sup>${m}</sup> √ó ${base}<sup>${n}</sup> = ${base}<sup>x</sup>`,
                        formula: "a<sup>m</sup> √ó a<sup>n</sup> = a<sup>m+n</sup>",
                        steps: [`1. Base is ${base}.`, `2. Add exponents: ${m} + ${n}`, `3. x = <b>${ans}</b>`]
                    };
                } else {
                    const m = this.randInt(4, 8);
                    const n = this.randInt(1, 3);
                    const ans = m - n;
                    return {
                        answer: ans,
                        desc: "Solve for x using the Quotient Rule (Division).",
                        display: `<div class="frac"><div class="frac-top">${base}<sup>${m}</sup></div><div class="frac-bot">${base}<sup>${n}</sup></div></div><span> = ${base}<sup>x</sup></span>`,
                        formula: "a<sup>m</sup> √∑ a<sup>n</sup> = a<sup>m-n</sup>",
                        steps: [`1. Base is ${base}.`, `2. Subtract exponents: ${m} - ${n}`, `3. x = <b>${ans}</b>`]
                    };
                }
            },

            generateVolume: function() {
                const shapes = ['cylinder', 'cone', 'sphere'];
                const type = shapes[this.randInt(0, shapes.length - 1)];
                const r = this.randInt(2, 5);
                const h = this.randInt(3, 8);
                let ans, displayHTML, formulaStr, stepsArr, svgHTML, descStr;

                if (type === 'cylinder') {
                    ans = (Math.PI*r*r*h).toFixed(2);
                    descStr = "Find Volume of Cylinder.";
                    displayHTML = `r = ${r}, h = ${h}`;
                    formulaStr = "Volume = œÄr¬≤h";
                    stepsArr = [`1. r¬≤ = ${r*r}`, `2. 3.14 √ó ${r*r} √ó ${h}`, `3. = <b>${ans}</b>`];
                    svgHTML = `<svg width="100" height="120"><ellipse cx="50" cy="15" rx="30" ry="10" fill="#ddd" stroke="#333"/><rect x="20" y="15" width="60" height="90" fill="#eee" stroke="none"/><line x1="20" y1="15" x2="20" y2="105" stroke="#333"/><line x1="80" y1="15" x2="80" y2="105" stroke="#333"/><ellipse cx="50" cy="105" rx="30" ry="10" fill="#eee" stroke="#333"/><text x="90" y="60" font-size="12">h=${h}</text><text x="50" y="125" font-size="12">r=${r}</text></svg>`;
                } else if (type === 'cone') {
                    ans = ((1/3)*Math.PI*r*r*h).toFixed(2);
                    descStr = "Find Volume of Cone.";
                    displayHTML = `r = ${r}, h = ${h}`;
                    formulaStr = "Volume = ‚ÖìœÄr¬≤h";
                    stepsArr = [`1. r¬≤ = ${r*r}`, `2. (3.14 √ó ${r*r} √ó ${h}) / 3`, `3. = <b>${ans}</b>`];
                    svgHTML = `<svg width="100" height="130"><polygon points="50,5 20,105 80,105" fill="#eee" stroke="#333"/><ellipse cx="50" cy="105" rx="30" ry="10" fill="#ddd" stroke="#333"/><line x1="50" y1="5" x2="50" y2="105" stroke="red" stroke-dasharray="4"/><text x="85" y="60" font-size="12">h=${h}</text><text x="50" y="125" font-size="12">r=${r}</text></svg>`;
                } else {
                    ans = ((4/3)*Math.PI*Math.pow(r,3)).toFixed(2);
                    descStr = "Find Volume of Sphere.";
                    displayHTML = `r = ${r}`;
                    formulaStr = "Volume = ‚Å¥‚ÅÑ‚ÇÉœÄr¬≥";
                    stepsArr = [`1. r¬≥ = ${r*r*r}`, `2. (4 √ó 3.14 √ó ${r*r*r}) / 3`, `3. = <b>${ans}</b>`];
                    svgHTML = `<svg width="100" height="120"><circle cx="50" cy="60" r="40" fill="#f0f0f0" stroke="#333"/><path d="M 10 60 Q 50 100 90 60" fill="none" stroke="#ccc"/><path d="M 10 60 Q 50 20 90 60" fill="none" stroke="#ccc" stroke-dasharray="4"/><line x1="50" y1="60" x2="90" y2="60" stroke="red"/><text x="60" y="55" font-size="12">r=${r}</text></svg>`;
                }

                return { answer: ans, desc: descStr, display: displayHTML, formula: formulaStr, steps: stepsArr, svg: svgHTML };
            },
            
            generateLinear: function() {
                const x = this.randInt(1, 10);
                const a = this.randInt(2, 6);
                const b = this.randInt(1, 10);
                return {
                    answer: x,
                    desc: "Solve for x.",
                    display: `${a}x + ${b} = ${a*x + b}`,
                    formula: "ax + b = c ‚Üí x = (c - b)/a",
                    steps: [`1. Move constant ${b} to right: ${a}x = ${(a*x+b)} - ${b}`, `2. ${a}x = ${a*x}`, `3. Divide by ${a}: x = <b>${x}</b>`]
                };
            },

            generateQuadFormula8: function() {
                const r1 = this.randInt(1, 4); 
                const r2 = this.randInt(1, 4);
                const bVal = -(r1 + r2);
                const cVal = r1 * r2;
                const ans = Math.max(r1, r2);
                return {
                    answer: ans,
                    desc: "Find the positive root.",
                    display: `x¬≤ ${bVal > 0 ? '+' + bVal : bVal}x + ${cVal} = 0`,
                    formula: "x = [-b ¬± ‚àö(b¬≤ - 4ac)] / 2a",
                    steps: [`1. a=1, b=${bVal}, c=${cVal}`, `2. D = ${bVal*bVal - 4*cVal}`, `3. x = [${-bVal} ¬± ‚àö${bVal*bVal - 4*cVal}] / 2`, `4. x = <b>${ans}</b>`]
                };
            },

            // ================= CLASS 9 =================
            generateAnglesBisect: function() {
                const mode = this.randInt(0, 2);
                const a = this.randInt(50, 130);
                let ans, descStr, dispStr, formStr, stepArr, svgHTML;

                if (mode === 0) {
                    ans = 180 - a;
                    descStr = "Linear Pair: Angles on a line sum to 180¬∞.";
                    dispStr = `Angle A = ${a}¬∞, Angle B = ?`;
                    formStr = "‚à†A + ‚à†B = 180¬∞";
                    stepArr = [`1. A and B are on a straight line.`, `2. 180 - ${a} = <b>${ans}¬∞</b>`];
                    svgHTML = `<svg width="200" height="120"><line x1="10" y1="100" x2="190" y2="100" stroke="#333" stroke-width="2"/><line x1="100" y1="100" x2="140" y2="30" stroke="#333" stroke-width="2"/><text x="115" y="85" font-size="12">${a}¬∞</text><text x="75" y="85" font-size="12">B?</text></svg>`;
                } else if (mode === 1) {
                    ans = a;
                    descStr = "Parallel Lines: Alternate/Corresponding angles are EQUAL.";
                    dispStr = `Line L1 || L2. Angle A = ${a}¬∞, Angle B = ?`;
                    formStr = "If Parallel: ‚à†A = ‚à†B";
                    stepArr = [`1. Identify relation: Alternate Interior or Corresponding.`, `2. These angles are equal.`, `3. B = <b>${a}¬∞</b>`];
                    svgHTML = `<svg width="200" height="140"><line x1="20" y1="40" x2="180" y2="40" stroke="#333" stroke-width="2"/><text x="185" y="45" font-size="12">L1</text><line x1="20" y1="100" x2="180" y2="100" stroke="#333" stroke-width="2"/><text x="185" y="105" font-size="12">L2</text><line x1="60" y1="20" x2="140" y2="120" stroke="#333" stroke-width="2"/><text x="75" y="55" font-size="12" fill="red">A=${a}¬∞</text><text x="115" y="95" font-size="12" fill="red">B?</text></svg>`;
                } else {
                    ans = 180 - a;
                    descStr = "Parallel Lines: Co-Interior angles sum to 180¬∞.";
                    dispStr = `Line L1 || L2. Angle A = ${a}¬∞, Angle B = ?`;
                    formStr = "‚à†A + ‚à†B = 180¬∞ (Interior same side)";
                    stepArr = [`1. Identify relation: Co-Interior (inside, same side).`, `2. They are supplementary.`, `3. 180 - ${a} = <b>${ans}¬∞</b>`];
                    svgHTML = `<svg width="200" height="140"><line x1="20" y1="40" x2="180" y2="40" stroke="#333" stroke-width="2"/><text x="185" y="45" font-size="12">L1</text><line x1="20" y1="100" x2="180" y2="100" stroke="#333" stroke-width="2"/><text x="185" y="105" font-size="12">L2</text><line x1="60" y1="20" x2="140" y2="120" stroke="#333" stroke-width="2"/><text x="100" y="55" font-size="12" fill="blue">A=${a}¬∞</text><text x="115" y="90" font-size="12" fill="blue">B?</text></svg>`;
                }
                return { answer: ans, desc: descStr, display: dispStr, formula: formStr, steps: stepArr, svg: svgHTML };
            },
            
            generateCircles: function() {
                const R = this.randInt(4, 7); 
                const r = this.randInt(1, R - 2); 
                const area = (Math.PI*(R*R - r*r)).toFixed(2);
                return {
                    answer: area,
                    desc: "Find Area of the shaded ring.",
                    display: `Outer R=${R}, Inner r=${r}`,
                    formula: "Area = œÄ(R¬≤ - r¬≤)",
                    steps: [`1. Outer Area: œÄ√ó${R}¬≤ ‚âà ${(Math.PI*R*R).toFixed(2)}`, `2. Inner Area: œÄ√ó${r}¬≤ ‚âà ${(Math.PI*r*r).toFixed(2)}`, `3. Subtract: <b>${area}</b>`],
                    svg: `<svg width="100" height="100"><circle cx="50" cy="50" r="45" fill="#ddd" stroke="#333"/><circle cx="50" cy="50" r="25" fill="#fff" stroke="#333"/></svg>`
                };
            },

            // --- FIXED: Heron's Formula randomization ---
            generateHeron: function() {
                // Generate a triple that forms a valid triangle (a + b > c)
                // Use a factorable result for simpler user testing
                // Simple (6, 8, 10) for area 24, s=12
                const factor = this.randInt(1, 2); 
                const a = 6 * factor;
                const b = 8 * factor;
                const c = 10 * factor;
                const s = (a + b + c) / 2; // Semi-perimeter
                const area = Math.sqrt(s * (s - a) * (s - b) * (s - c)); // Area is a whole number (24 * factor^2)
                
                // SVG for visual aid (still 3:4:5 ratio)
                const svgW = 150; 
                const svgH = 100;
                const base = svgW - 40;
                const height = svgH - 10;
                
                return {
                    answer: area,
                    desc: "Calculate Triangle Area using Heron's Formula.",
                    display: `Sides: ${a}, ${b}, ${c}`,
                    formula: "Area = ‚àös(s-a)(s-b)(s-c), where s = (a+b+c)/2",
                    steps: [
                        `1. Calculate semi-perimeter (s): s = (${a}+${b}+${c})/2 = <b>${s}</b>`, 
                        `2. Calculate inner term: ${s}(${s}-${a})(${s}-${b})(${s}-${c}) = ${s} √ó ${(s-a)} √ó ${(s-b)} √ó ${(s-c)} = <b>${s * (s-a) * (s-b) * (s-c)}</b>`, 
                        `3. Area = ‚àö${s * (s-a) * (s-b) * (s-c)}`, 
                        `4. Area = <b>${area}</b>`
                    ],
                    svg: `<svg width="150" height="100"><polygon points="20,90 20,20 120,90" fill="#FFE66D" stroke="#333" stroke-width="2"/><text x="10" y="55">${b}</text><text x="70" y="98">${a}</text><text x="80" y="50">${c}</text></svg>`
                };
            },

            // --- FIXED: Statistics randomization ---
            generateStats: function() {
                const count = this.randInt(5, 7);
                let nums = [];
                let sum = 0;
                for(let i=0; i<count; i++) {
                    let num = this.randInt(1, 15);
                    nums.push(num);
                    sum += num;
                }
                const mean = (sum / count).toFixed(2);

                return {
                    answer: mean,
                    desc: "Find the Mean of the dataset.",
                    display: `Data: [ ${nums.join(', ')} ]`,
                    formula: "Mean = Sum / Count",
                    realWorld: "üåç <b>Scenario:</b> Used to determine the average score of a class.",
                    steps: [
                        `1. Sum = ${sum}`, 
                        `2. Count = ${count}`, 
                        `3. ${sum} √∑ ${count} = <b>${mean}</b>`
                    ]
                };
            },

            // ================= CLASS 10 =================
            
            generateAPTerm: function() {
                const a = this.randInt(5, 10); 
                const d = this.randInt(2, 4);  
                const n = this.randInt(10, 15);  
                const ans = a + (n-1)*d;
                return {
                    answer: ans,
                    desc: "Find the n-th term of the Arithmetic Progression.",
                    realWorld: `üåç <b>Scenario:</b> A theater has ${a} seats in row 1, and each subsequent row has ${d} more seats.`,
                    display: `a = ${a}, d = ${d}, find term ${n}`,
                    formula: "a<sub>n</sub> = a + (n - 1)d",
                    steps: [`1. Identify: a=${a}, d=${d}, n=${n}`, `2. Substitute: ${a} + (${n}-1)√ó${d}`, `3. Simplify: ${a} + (${n-1})√ó${d}`, `4. ${a} + ${(n-1)*d} = <b>${ans}</b>`]
                };
            },

            // --- FIXED: AP Sum randomization for 'n' ---
            generateAPSum: function() {
                const a = this.randInt(1, 5);
                const d = this.randInt(2, 4);
                const n = this.randInt(8, 15); // Random 'n'
                const ans = (n/2) * (2*a + (n-1)*d);
                return {
                    answer: ans,
                    desc: `Find the Sum of the first ${n} terms.`,
                    realWorld: `üåç <b>Scenario (Summation):</b> You save $${a} in week 1, and increase savings by $${d} each week. How much total money after ${n} weeks?`,
                    display: `Series: ${a}, ${a+d}, ${a+2*d}... (n=${n})`,
                    formula: "S<sub>n</sub> = (n/2) √ó [2a + (n-1)d]",
                    steps: [
                        `1. n=${n}, a=${a}, d=${d}`, 
                        `2. 2a = ${2*a}`, 
                        `3. (n-1)d = ${n-1} √ó ${d} = ${(n-1)*d}`, 
                        `4. Bracket Sum = ${2*a + (n-1)*d}`, 
                        `5. ${n/2} √ó ${2*a + (n-1)*d} = <b>${ans}</b>`
                    ]
                };
            },

            // --- FIXED: GP Term randomization for a, r, n ---
            generateGPTerm: function() {
                const a = this.randInt(2, 5); 
                const r = this.randInt(2, 3); // Keep ratio small for manageable numbers
                const n = this.randInt(4, 6); // Keep n small for manageable numbers
                const ans = a * Math.pow(r, n-1); 
                return {
                    answer: ans,
                    desc: `Find the ${n}-th term of the Geometric Progression.`,
                    realWorld: `üåç <b>Scenario:</b> A bacteria culture starts with ${a}. It multiplies by ${r} every hour.`,
                    display: `a = ${a}, r = ${r}, n = ${n}`,
                    formula: "a<sub>n</sub> = a √ó r<sup>(n - 1)</sup>",
                    steps: [
                        `1. a=${a}, r=${r}, n=${n}`, 
                        `2. r<sup>n-1</sup> = ${r}<sup>${n-1}</sup> = ${Math.pow(r, n-1)}`, 
                        `3. ${a} √ó ${Math.pow(r, n-1)} = <b>${ans}</b>`
                    ]
                };
            },

            // --- FIXED: GP Sum randomization for a, r, n ---
            generateGPSum: function() {
                const a = this.randInt(1, 3);
                const r = this.randInt(2, 3); 
                const n = this.randInt(4, 6);
                const num = a * (Math.pow(r, n) - 1);
                const den = r - 1;
                const ans = num / den;
                return {
                    answer: ans,
                    desc: `Calculate the Total Sum of the first ${n} terms.`,
                    realWorld: `üåç <b>Scenario (Multiplication/Growth):</b> A post gets ${a} share. Each share gets ${r} reshares (Multiplication). What is the TOTAL shares after ${n} cycles?`,
                    display: `a = ${a}, r = ${r}, n = ${n}`,
                    formula: "S<sub>n</sub> = a(r<sup>n</sup> - 1) / (r - 1)",
                    steps: [
                        `1. r<sup>n</sup> = ${r}<sup>${n}</sup> = ${Math.pow(r,n)}`, 
                        `2. Numerator: ${a} √ó (${Math.pow(r,n)} - 1) = ${a*(Math.pow(r,n)-1)}`, 
                        `3. Denominator: ${r} - 1 = ${r-1}`,
                        `4. ${a*(Math.pow(r,n)-1)} / ${r-1} = <b>${ans}</b>`
                    ]
                };
            },

            // --- TRIGONOMETRY (BASIC) with SIN/COS/TAN ---
            generateTrig: function() {
                // Toggle between Pythagoras (type 0) and Basic Ratios (type 1)
                const type = Math.random() > 0.5 ? 0 : 1; 
                const svgW = 160; const svgH = 120;
                
                if (type === 0) {
                    // PYTHAGORAS
                    const scale = this.randInt(2, 4); 
                    const base = 4 * scale;
                    const height = 3 * scale;
                    const hyp = 5 * scale;
                    return {
                        answer: hyp,
                        desc: "Find the length of the Hypotenuse (c).",
                        realWorld: "üåç <b>Scenario:</b> Used to find the length of a ladder needed to reach a window.",
                        display: `Altitude (a) = ${height}, Base (b) = ${base}`,
                        formula: "c¬≤ = a¬≤ + b¬≤ (Pythagoras)",
                        steps: [`1. ${height}¬≤ + ${base}¬≤`, `2. ${height*height} + ${base*base}`, `3. ‚àö${height*height + base*base} = <b>${hyp}</b>`],
                        svg: `<svg width="200" height="180" viewBox="0 0 200 180"><path d="M40,160 L${40 + svgW},160 L40,${160 - svgH} Z" fill="#e0f7fa" stroke="#006064" stroke-width="3"/><rect x="40" y="${160-20}" width="20" height="20" fill="none" stroke="#006064" stroke-width="2"/><text x="30" y="${160 - svgH/2}" font-size="14" font-weight="bold" fill="#333" text-anchor="end">a=${height}</text><text x="${40 + svgW/2}" y="175" font-size="14" font-weight="bold" fill="#333" text-anchor="middle">b=${base}</text><text x="${40 + svgW/2 + 10}" y="${160 - svgH/2 - 5}" font-size="14" font-weight="bold" fill="#d32f2f" text-anchor="start">c=?</text></svg>`
                    };
                } else {
                    // BASIC RATIOS (SIN/COS/TAN)
                    const angles = [30, 45, 60];
                    const angle = angles[this.randInt(0, angles.length - 1)];
                    let hyp, ans, funcName;
                    
                    // Case: Find Opposite given Hypotenuse (SIN)
                    hyp = this.randInt(10, 20);
                    let sinValue;
                    if(angle === 30) {
                        sinValue = 0.5;
                        ans = hyp * sinValue; 
                    } else if (angle === 45) {
                        sinValue = 0.7071; // sin(45) approx
                        ans = hyp * sinValue;
                    } else { // 60
                        sinValue = 0.8660; // sin(60) approx
                        ans = hyp * sinValue;
                    }
                    ans = ans.toFixed(2);
                    
                    return {
                        answer: ans,
                        desc: `Find the <b>Opposite</b> side length given Hypotenuse and Angle.`,
                        display: `Angle = ${angle}¬∞, Hypotenuse = ${hyp}, Find Opposite (x)`,
                        formula: `Sin(Œ∏) = Opposite / Hypotenuse`,
                        realWorld: "üåç <b>Scenario:</b> Calculating height of a tree if you know distance and angle of elevation.",
                        steps: [
                            `1. Formula: Sin(${angle}) = x / ${hyp}`,
                            `2. Value: Sin(${angle}¬∞) ‚âà ${sinValue.toFixed(4)}`,
                            `3. x = ${hyp} √ó Sin(${angle})`,
                            `4. x = <b>${ans}</b>`
                        ],
                        svg: `<svg width="200" height="180" viewBox="0 0 200 180"><path d="M40,160 L180,160 L180,${160-svgH} Z" fill="#fff3e0" stroke="#e65100" stroke-width="3"/><path d="M40,160 L70,160 A30,30 0 0,0 65,145 Z" fill="#ffe0b2"/><text x="80" y="155" font-size="12">${angle}¬∞</text><text x="110" y="${160 - svgH/2 - 10}" font-size="14">Hyp=${hyp}</text><text x="190" y="${160 - svgH/2}" font-size="14" fill="red">x</text></svg>`
                    };
                }
            },

            // --- TRIGONOMETRY (ADVANCED) ---
            generateTrigAdvanced: function() {
                // Types: 0 = Find Angle, 1 = Area of Triangle
                const type = Math.random() > 0.5 ? 0 : 1;
                
                if(type === 0) {
                    // FIND ANGLE (Inverse Trig)
                    const targetAngle = [30, 45, 60][this.randInt(0, 2)];
                    let opp, hyp, ratio;
                    
                    if(targetAngle === 30) {
                        hyp = 20; opp = 10; ratio = 0.5;
                    } else if (targetAngle === 45) {
                        hyp = 14.14; opp = 10; ratio = 0.707;
                    } else { // 60
                        hyp = 20; opp = 17.32; ratio = 0.866;
                    }

                    return {
                        answer: targetAngle,
                        desc: "Find the Angle Œ∏ (in degrees).",
                        realWorld: "üåç <b>Scenario:</b> Determining the angle of a ramp for wheelchair accessibility.",
                        display: `Opposite = ${opp.toFixed(2)}, Hypotenuse = ${hyp.toFixed(2)}`,
                        formula: "Sin(Œ∏) = Opp / Hyp ‚Üí Œ∏ = Sin‚Åª¬π(ratio)",
                        steps: [
                            `1. Ratio = ${opp.toFixed(2)} / ${hyp.toFixed(2)} ‚âà ${ratio.toFixed(3)}`,
                            `2. Which angle has Sin ‚âà ${ratio.toFixed(3)}?`,
                            `3. (Ref: Sin30=0.5, Sin45‚âà0.707, Sin60‚âà0.866)`,
                            `4. Œ∏ = <b>${targetAngle}</b>`
                        ],
                        svg: `<svg width="200" height="180" viewBox="0 0 200 180"><path d="M40,160 L180,160 L180,60 Z" fill="#f3e5f5" stroke="#4a148c" stroke-width="3"/><path d="M40,160 L70,160 A30,30 0 0,0 65,145 Z" fill="#e1bee7"/><text x="80" y="155" font-size="14" font-weight="bold">Œ∏?</text><text x="110" y="100" font-size="12">Hyp=${hyp.toFixed(2)}</text><text x="185" y="110" font-size="12">Opp=${opp.toFixed(2)}</text></svg>`
                    };

                } else {
                    // AREA OF TRIANGLE (1/2 ab Sin C)
                    const angle = 30; // Stick to 30 for easy math (Sin30 = 0.5)
                    const a = this.randInt(5, 10) * 2; 
                    const b = this.randInt(5, 10) * 2;
                    const ans = 0.5 * a * b * 0.5;

                    return {
                        answer: ans,
                        desc: "Find the Area of the Triangle.",
                        realWorld: "üåç <b>Scenario:</b> Finding land area when shape is irregular triangles.",
                        display: `Side A = ${a}, Side B = ${b}, Included Angle = ${angle}¬∞`,
                        formula: "Area = ¬Ω √ó a √ó b √ó Sin(Œ∏)",
                        steps: [
                            `1. Formula: 0.5 √ó ${a} √ó ${b} √ó Sin(${angle})`,
                            `2. Sin(30¬∞) = 0.5`,
                            `3. Calculation: 0.5 √ó ${a} √ó ${b} √ó 0.5`,
                            `4. Area = <b>${ans}</b>`
                        ],
                        svg: `<svg width="200" height="150" viewBox="0 0 200 150"><path d="M20,130 L180,130 L60,50 Z" fill="#e8f5e9" stroke="#1b5e20" stroke-width="2"/><text x="100" y="145" font-size="12">Side A=${a}</text><text x="30" y="85" font-size="12">Side B=${b}</text><text x="50" y="115" font-size="12" fill="red">${angle}¬∞</text></svg>`
                    };
                }
            },

            generateQuadFormula10: function() {
                const x1 = this.randInt(1, 5);
                const x2 = this.randInt(1, 5); 
                const bVal = -(x1 + x2);
                const cVal = x1 * x2;
                const ans = Math.max(x1, x2);
                return {
                    answer: ans,
                    desc: "Solve for x using the Quadratic Formula. (Find the larger root)",
                    realWorld: "üåç <b>Scenario:</b> Calculating the time it takes for a projectile to hit the ground.",
                    display: `x¬≤ ${bVal > 0 ? '+' + bVal : bVal}x + ${cVal} = 0`,
                    formula: "x = [-b ¬± ‚àö(b¬≤ - 4ac)] / 2a",
                    steps: [`1. a=1, b=${bVal}, c=${cVal}`, `2. D = ${bVal*bVal - 4*cVal}`, `3. x = [${-bVal} ¬± ‚àö${bVal*bVal - 4*cVal}] / 2`, `4. x = <b>${ans}</b>`]
                }
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => { app.loadClass(8); });
    </script>
</body>
</html>
